<!DOCTYPE html>
<html>

<head>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <nav class="navbar navbar-dark bg-dark px-3 sticky-top">
        <span class="navbar-brand">Admin Panel</span>
        <div>
            <a href="/admin/users" class="btn btn-outline-light btn-sm">Users</a>
            <a href="/admin/emails" class="btn btn-outline-light btn-sm">Emails</a>
            <a href="/admin/logout" class="btn btn-danger btn-sm">Logout</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row text-center">

            <div class="col-md-4">
                <div class="card p-4 shadow">
                    <h4>Total Users</h4>
                    <h2>{{ user_count }}</h2>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card p-4 shadow">
                    <h4>Total Emails</h4>
                    <h2>{{ email_count }}</h2>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card p-4 shadow">
                    <h4>Spam Emails</h4>
                    <h2>{{ spam_count }}</h2>
                    <!-- <h2>{{ spam_rate }}%</h2> -->
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    Spam vs Not Spam Distribution
                </div>
                <div class="card-body d-flex justify-content-center">
                    <div style="width: 400px; margin: auto;">
                        <canvas id="spamChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    Recent Emails
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <tr>
                            <th>From</th>
                            <th>Subject</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>

                        {% for e in recent_emails %}
                        <tr>
                            <td>{{ e[0] }}</td>
                            <td>{{ e[1] }}</td>
                            <td>
                                {% if e[2] == "SPAM" %}
                                <span class="badge bg-danger">SPAM</span>
                                {% else %}
                                <span class="badge bg-success">SAFE</span>
                                {% endif %}
                            </td>
                            <td>{{ e[3] }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
                <br>
            </div>
            <br>
            <div class="card text-center">
                <div class="card-body">
                    <h6>Spam Rate</h6>
                    <h3>{{ spam_rate }}%</h3>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h6>ML Model</h6>
                    <p>Naive Bayes (TF-IDF)</p>
                    <p>Accuracy: 97%</p>
                    <p>Last Trained: Feb 2026</p>
                </div>
            </div>

        </div>
    </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- <canvas id="spamChart"></canvas> -->

<script>
    const ctx = document.getElementById('spamChart').getContext('2d');

    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Spam', 'Not Spam'],
            datasets: [{
                data: [{{ spam_count }}, {{ ham_count }}],
        backgroundColor: ['#0d6efd', '#dc3545']
    }]
    },
        options: {
        responsive: true,
        maintainAspectRatio: false,   // ðŸ”¥ THIS FIXES IT
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});
</script>

</html>